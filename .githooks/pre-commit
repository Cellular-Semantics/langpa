#!/usr/bin/env bash
set -o errexit
set -o pipefail

echo "[githook] Running Ruff lint..."
uv run ruff check --fix src/ tests/

echo "[githook] Checking formatting..."
uv run ruff format --check src/ tests/

echo "[githook] Running unit tests..."
uv run pytest -m unit

echo "[githook] Running integration tests (requires real API keys)..."
if [[ -z "${OPENAI_API_KEY}" || -z "${ANTHROPIC_API_KEY}" ]]; then
  echo "[githook] Skipping integration tests; missing OPENAI_API_KEY or ANTHROPIC_API_KEY"
else
  uv run pytest -m integration
fi
